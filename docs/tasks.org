#+title: Tasks

* Bugs

** TODO File-level node position mismatch
Sync writes ~Pos: 1~ for file-level nodes. NodeOperations uses ~0~. An agent that reads a position from one code path and uses it in another gets wrong results.

** TODO ~roam node read~ returns entire file, not node subtree
If a file has multiple headline-level nodes, ~node read~ for one of them dumps the whole file. Should return just the node's subtree.

** TODO ~read~ and ~export~ ignore ~-f json~
They dump raw text even when ~-f json~ is passed. Every other command wraps output in the ~{"ok":true,"data":...}~ envelope. These two break the contract.

** TODO ~search~ returns line numbers, not headline positions
Every other command addresses headlines by position or ID. Search results can't be fed to mutation commands without re-resolving.

** TODO ~node create~ doesn't expose most of its options
~CreateNodeOptions~ supports ~Id~, ~TodoKeyword~, ~Priority~, ~Scheduled~, ~Deadline~, ~Level~, ~Content~. The CLI only exposes ~Tags~, ~Aliases~, ~Refs~, and ~Parent~.

** TODO ~listOrgFiles~ misses encrypted files
Doesn't find ~.org.gpg~ or ~.org.age~ files.

** TODO ~splitQuotedString~ doesn't handle escaped quotes

** TODO Timestamps accept only ~yyyy-MM-dd~
No time component, no repeaters, no warning periods. ~<2026-03-01 Sun 14:00 +1w -3d>~ is valid org syntax but can't be specified through the CLI.

* Missing functionality

** TODO No ~node delete~ command
~deleteNode~ exists in NodeOperations.fs but has no CLI entry point.

** TODO No ~node rename~
Can't change a node's title.

** TODO No body content write
Can set metadata (TODO, tags, properties, timestamps) but can't write body text under a headline. ~note~ appends to the logbook only. An agent building a knowledge base needs to write prose.

** TODO No body content read for a single headline
~read~ dumps raw text for a whole subtree. No way to get just the body of one headline as structured output.

** TODO No ~link remove~
Can add links, can't remove them.

** TODO No ~unarchive~
Archive is one-way.

** TODO No multi-tag filtering
~--tag work~ works but ~--tag work --tag urgent~ doesn't intersect. No negation (~--not-tag waiting~). No state exclusion.

** TODO No graph export
No way to get all nodes and edges in one call. Agent must query one node at a time.

** TODO No date range on clock report
Returns all entries. No ~--from~ / ~--to~ filtering.

** TODO ~add~ doesn't set ~:ID:~ by default
Created headlines have no stable identifier unless the agent follows up with ~property set~. Position-based addressing breaks after any edit.

** TODO ~completions~ command not in schema
Exists in Program.fs but absent from ~commandDefs~ in JsonOutput.fs. Invisible to agents reading the schema.
